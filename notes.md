# Notes

## Deployment issue and fixes

### **Key Problems & Solutions**

#### **1. Missing Build Step in Deployment**

- **Mistake**:
  Vercel didn’t know it needed to generate `output.css` during deployment.
- **Fix**:
  Added `build:css` script to `package.json` and configured `vercel.json` to handle static files.
- **Why It Worked**:
  Vercel now automatically runs `npm run build:css` before deploying, creating the minified CSS file.

#### **2. Incorrect Static File Handling**

- **Mistake**:
  Your original `vercel.json` didn’t specify how to serve static files (like CSS).
- **Fix**:
  Added this block to `vercel.json`:

  ```json
  {
    "src": "public/**",
    "use": "@vercel/static"
  }
  ```

- **Why It Worked**:
  Vercel now treats the `public/` folder as a static asset directory.

#### **3. Path Mismatch**

- **Mistake**:
  The deployed app might have looked for `output.css` in the wrong path.
- **Fix**:
  Ensured your HTML linked to `/output.css` (root-relative path) and that the file was in `public/`.
- **Why It Worked**:
  Express serves files from `public/` at the root URL (`/`).

---

### **Critical Lessons Learned**

#### **A. For Vercel Deployments**

1. **Always define build steps**:
   Vercel doesn’t assume you need to build assets like Tailwind CSS.

   - ✅ **Do this**: Add `build` scripts to `package.json`.

2. **Explicitly declare static files**:
   Node.js apps need manual configuration for static assets.
   - ✅ **Do this**: Use `@vercel/static` for CSS/images.

#### **B. For Tailwind CSS**

1. **Never rely on local builds**:
   What works locally (`--watch`) won’t work in production.

   - ✅ **Do this**: Always commit the built CSS or configure the deploy to build it.

2. **Use absolute paths**:
   `./output.css` fails if the app isn’t running from the root directory.
   - ✅ **Do this**: Always use `/output.css` in HTML.

#### **C. General Best Practices**

1. **Test production builds locally first**:

   ```bash
   npm run build:css && npm start
   ```

2. **Check deployment logs**:
   Vercel’s logs show if the build failed or files are missing.

---

### **How to Avoid These Mistakes in Future Projects**

1. **Start with this `vercel.json` template** for Express + Tailwind:

   ```json
   {
     "version": 2,
     "builds": [
       { "src": "package.json", "use": "@vercel/static-build" },
       { "src": "index.js", "use": "@vercel/node" }
     ],
     "routes": [
       { "src": "/api/(.*)", "dest": "index.js" },
       { "src": "/(.*)", "dest": "public/$1" }
     ]
   }
   ```

2. **Use these `package.json` scripts** as a baseline:

   ```json
   "scripts": {
     "dev": "tailwindcss -i ./src/input.css -o ./public/output.css --watch",
     "build": "tailwindcss -i ./src/input.css -o ./public/output.css --minify",
     "start": "node index.js"
   }
   ```

3. **Verify file structure** before deploying:

   ```plaintext
   /public
     output.css    # Generated by build
   /src
     input.css     # With @tailwind directives
   ```

---

### **Final Tip**

For even smoother deployments, consider:

- Adding a `postinstall` script:

  ```json
  "postinstall": "npm run build"
  ```

- Using the Vercel CLI to test locally:

  ```bash
  npm i -g vercel
  vercel dev
  ```

This ensures your deployment pipeline mimics production.
